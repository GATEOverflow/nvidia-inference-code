# MAKE Targets and RUN_ARGS Documentation
**NOTE**: This document is autogenerated from internal documentation. If something is wrong or confusing, please contact NVIDIA.

---

Our Makefile includes many targets and options. Below are some of the more relevant and commonly used ones:

### Make Targets

To execute outside the shell, with environment variable `NETWORK_NODE` is either set to `LON` or `SUT`:

- `make prebuild`: Runs the following steps:
    - `make build_docker`: Builds docker image.
    - `make docker_add_user`: Adds current user to the docker image.
    - `make attach_docker`: Runs docker image with an interactive session and with current working directory bound to `/work` in the container. You are left with an interactive shell inside the container at `/work`.
- `make update_results`: Updates the results/ directory with the logs in `build/logs`. Run during the submission process.
- `make check_submission`: Runs the official submission checker on the current state of the repo. Run during the submission process.

These `make` commands are run inside the Docker container shell, that you get by running `make prebuild` (see above):

- `make download_dataset`: Downloads datasets.
- `make preprocessed_data`: Preprocesses the downloaded datasets.
- `make build`: Runs the following steps:
    - `make link_dirs`: Adds symlinks in `build/` to the relevant directories from `$MLPERF_SCRATCH_PATH`
    - `make clone_loadgen`: Clone the official MLPerf inference GitHub repo.
    - `make build_plugins`: Builds TensorRT plugins.
    - `make build_loadgen`: Builds LoadGen source codes.
    - `make build_harness`: Builds the harnesses.
- `make run RUN_ARGS="--benchmarks=<BENCHMARKS> --scenarios=<SCENARIOS> [OTHER RUN_ARGS FLAGS] --config_ver=lon_node[_high_accuracy]"` runs the following steps:
    - `make generate_engines RUN_ARGS="--benchmarks=<BENCHMARKS> --scenarios=<SCENARIOS> [OTHER RUN_ARGS FLAGS] --config_ver=lon_node[_high_accuracy]"`: Generates TensorRT optimized engine files. This command is launched in the LoadGen node and the SUT node will generate the engine files accordingly.
    - `make run_harness RUN_ARGS="--benchmarks=<BENCHMARKS> --scenarios=<SCENARIOS> [OTHER RUN_ARGS FLAGS] --config_ver=lon_node[_high_accuracy]"`: Runs harnesses with engine files and LoadGen. This command is launched in the LoadGen node. Any command needed for the SUT node will be launched via SSH from LoadGen node.
    - See RUN_ARGS flags.
- `make calibrate RUN_ARGS="--benchmarks=<BENCHMARKS>  --config_ver=lon_node"`: Generates calibration caches. Similarly, this command is launched in the LoadGen node.
    - See RUN_ARGS flags.
- `make clean`: Cleans up all the build directories. Please note that you will need to exit the docker container and run `make prebuild` again after the cleaning.
- `make clean_shallow`: Cleans up only the files needed to make a clean build. This includes any binaries and files that require compilation.

### RUN_ARGS Flags

- `--benchmarks=comma,separated,list,of,benchmark,names`
- `--scenarios=comma,separated,list,of,scenario,names`
- `--config_ver=comma,separated,list,of,config,versions`
- `--test_mode=[PerformanceOnly,AccuracyOnly]`: Specifies which LoadGen mode to run with.
- `--no_gpu`: Disables generating / running GPU engine (Xavier only).
- `--gpu_only`: Disables generating / running DLA engine (Xavier only).
- `--force_calibration`: Forces recalculation of calibration cache.
- `--log_dir=path/to/logs`: Specifies where to save logs.
- `--log_copy_detail_to_stdout`: Prints LoadGen detailed logs to stdout as well as to the log files.
- `--verbose`: Prints out verbose logs.

### Config Versions

There are four types of config versions which can be passed into the `--config_ver` flag:

1. `default`: This is the default config, as shown in `config.json`. No overrides are applied Uses custom harness with low accuracy target. Supported for all benchmarks.
2. `high_accuracy`: Runs the benchmark for the 99.9% of FP32 accuracy target. Uses custom harness with high accuracy target. Supported only for BERT.

`all`: Runs every `config_ver` available in `config.json`. This will override all other `config_ver` options specified by the flag.

Passing in comma-separated list of config versions or passing in `all` allows you to generate the engines or to run harness for multiple config versions in one command.

